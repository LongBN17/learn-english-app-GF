<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Learn English - App</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 1600px;
      width: 96%;
      margin: 0 auto;
      background: white;
      border-radius: 24px;
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
      color: white;
      padding: 30px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: rotate 20s linear infinite;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .header h1 {
      font-size: 42px;
      margin-bottom: 10px;
      font-weight: 700;
      position: relative;
      z-index: 1;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .header .subtitle {
      opacity: 0.95;
      font-size: 18px;
      position: relative;
      z-index: 1;
    }

    .stats-bar {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      padding: 25px;
      background: linear-gradient(to bottom, #f8f9fa, #ffffff);
      border-bottom: 2px solid #e9ecef;
    }

    .stat {
      text-align: center;
      padding: 15px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: transform 0.2s ease;
    }

    .stat:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    .stat-label {
      font-size: 11px;
      color: #6c757d;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .tabs {
      display: flex;
      background: #f8f9fa;
      border-bottom: 2px solid #e9ecef;
      padding: 0 30px;
    }

    .tab {
      padding: 20px 30px;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      font-size: 16px;
      font-weight: 600;
      color: #6b7280;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .tab:hover {
      color: #3b82f6;
      background: rgba(59, 130, 246, 0.05);
    }

    .tab.active {
      color: #3b82f6;
      border-bottom-color: #3b82f6;
      background: white;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Tab Luy·ªán t·∫≠p: card tr√°i, n√∫t b√™n ph·∫£i ‚Äî m·ªü r·ªông t·∫≠n d·ª•ng m√†n h√¨nh */
    .practice-layout {
      display: flex;
      gap: 40px;
      align-items: flex-start;
      max-width: none;
      width: 100%;
      margin: 0;
    }
    .practice-left {
      flex: 1;
      min-width: 0;
    }
    .practice-right {
      flex-shrink: 0;
      width: 380px;
      min-width: 380px;
      position: sticky;
      top: 24px;
      overflow: visible;
    }
    .actions-sidebar {
      grid-template-columns: 1fr;
      margin-top: 0;
      gap: 12px;
      min-width: 0;
    }
    .actions-sidebar .btn {
      width: 100%;
      min-width: 0;
      justify-content: center;
      text-align: center;
      padding: 14px 16px;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.3px;
      white-space: normal;
      line-height: 1.3;
      overflow: visible;
      box-sizing: border-box;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    .practice-right .shortcuts {
      margin-top: 24px;
      font-size: 13px;
      padding: 16px;
      min-width: 0;
      overflow-wrap: break-word;
      word-break: break-word;
      line-height: 1.6;
    }
    .practice-right .shortcuts strong {
      display: block;
      margin-bottom: 8px;
    }
    .practice-right .shortcuts span {
      display: block;
      margin: 6px 0 0 0;
      padding: 4px 0;
    }
    @media (max-width: 900px) {
      .practice-layout {
        flex-direction: column;
      }
      .practice-right {
        width: 100%;
        position: static;
      }
      .actions-sidebar {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    .main-content {
      padding: 40px 56px 56px;
      max-width: none;
    }

    .card-container {
      perspective: 1000px;
      margin-bottom: 40px;
    }

    .card {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border: none;
      border-radius: 24px;
      padding: 48px 40px;
      min-height: 680px;
      height: 680px;
      box-sizing: border-box;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow-x: hidden;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, #3b82f6, #1e40af, #60a5fa, #93c5fd);
      background-size: 200% 100%;
      animation: gradient 3s ease infinite;
    }

    @keyframes gradient {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
    }

    .card.flip {
      animation: flipCard 0.6s ease-in-out;
    }

    @keyframes flipCard {
      0% { transform: rotateY(0deg); }
      50% { transform: rotateY(90deg); }
      100% { transform: rotateY(0deg); }
    }

    .term-container {
      text-align: center;
      margin-bottom: 30px;
    }

    .term {
      font-size: 72px;
      font-weight: 700;
      color: #111827;
      margin-bottom: 20px;
      line-height: 1.2;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
      display: inline-block;
      padding: 20px 40px;
      background: linear-gradient(135deg, #fff5f5 0%, #fff9e6 100%);
      border-radius: 16px;
      border: 3px solid #f0f0f0;
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
    }

    .ipa-container {
      margin-bottom: 25px;
    }

    .ipa {
      font-size: 32px;
      text-align: center;
      margin-bottom: 10px;
      font-weight: 600;
      letter-spacing: 2px;
      color: #3b82f6;
    }

    .ipa-text {
      display: inline-block;
      padding: 8px 16px;
      margin: 4px;
      border-radius: 8px;
      background: linear-gradient(135deg, #3b82f615 0%, #1e40af15 100%);
      border: 2px solid #3b82f630;
      font-weight: 600;
      color: #3b82f6;
      transition: all 0.3s ease;
      font-family: 'Courier New', monospace;
    }

    .ipa-text:hover {
      background: linear-gradient(135deg, #3b82f625 0%, #1e40af25 100%);
      transform: scale(1.05);
    }

    .level-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 700;
      margin-left: 10px;
      text-transform: uppercase;
    }

    .level-A1, .level-A2 { background: #10b981; color: white; }
    .level-B1, .level-B2 { background: #3b82f6; color: white; }
    .level-C1, .level-C2 { background: #8b5cf6; color: white; }

    .meaning-container {
      margin-bottom: 30px;
    }

    .meaning {
      font-size: 26px;
      color: #374151;
      text-align: center;
      font-weight: 600;
      padding: 20px 30px;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border-radius: 12px;
      border-left: 5px solid #3b82f6;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
    }

    .example {
      font-size: 18px;
      color: #6b7280;
      text-align: center;
      font-style: italic;
      margin-bottom: 25px;
      padding: 20px;
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      border-radius: 12px;
      border: 2px dashed #d1d5db;
      line-height: 1.6;
    }

    .example::before {
      content: 'üí° ';
      margin-right: 8px;
    }

    .grammar-formula {
      font-size: 24px;
      font-weight: 700;
      color: #3b82f6;
      text-align: center;
      padding: 15px;
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      border-radius: 12px;
      margin-bottom: 15px;
      font-family: 'Courier New', monospace;
    }

    .grammar-info {
      margin-bottom: 15px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      border-left: 4px solid #3b82f6;
    }

    .grammar-info strong {
      color: #1e40af;
      display: block;
      margin-bottom: 5px;
    }

    .quiz-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

    .quiz-option {
      padding: 18px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 16px;
      font-weight: 500;
      text-align: center;
    }

    .quiz-option:hover {
      border-color: #3b82f6;
      background: #eff6ff;
      transform: translateY(-2px);
    }

    .quiz-option.correct {
      background: #10b981;
      color: white;
      border-color: #059669;
    }

    .quiz-option.wrong {
      background: #ef4444;
      color: white;
      border-color: #dc2626;
    }

    .hint {
      display: none;
      font-size: 16px;
      color: #374151;
      text-align: center;
      margin-top: 20px;
      padding: 18px;
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 12px;
      border-left: 5px solid #f59e0b;
      font-weight: 500;
      line-height: 1.6;
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.2);
    }

    .hint.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    #quizHint {
      margin-top: 25px;
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border-left-color: #3b82f6;
      color: #1e40af;
      font-weight: 600;
    }

    /* ===== FILL IN THE BLANK ===== */
    .fillblank-sentence {
      font-size: 20px;
      line-height: 1.6;
      margin-bottom: 20px;
      padding: 15px;
      background: #f0f9ff;
      border-radius: 12px;
      border-left: 4px solid #3b82f6;
    }
    .fillblank-sentence .blank {
      display: inline-block;
      min-width: 80px;
      border-bottom: 2px solid #1e40af;
      margin: 0 4px;
      padding: 2px 8px;
      text-align: center;
      font-weight: 600;
      color: #1e40af;
    }
    .fillblank-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 16px;
    }
    .fillblank-option {
      padding: 14px 18px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      background: white;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      text-align: center;
      transition: all 0.2s ease;
    }
    .fillblank-option:hover {
      border-color: #3b82f6;
      background: #eff6ff;
    }
    .fillblank-option.correct { background: #10b981; color: white; border-color: #059669; }
    .fillblank-option.wrong { background: #ef4444; color: white; border-color: #dc2626; }

    /* ===== REORDER SENTENCE ===== */
    .reorder-instruction {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 16px;
    }
    .reorder-answer-area {
      min-height: 56px;
      padding: 16px;
      margin-bottom: 16px;
      background: #f8fafc;
      border: 2px dashed #cbd5e1;
      border-radius: 12px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
    }
    .reorder-answer-area.filled {
      border-style: solid;
      border-color: #94a3b8;
    }
    .reorder-words {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 12px;
      min-height: 50px;
      padding: 8px;
    }
    .reorder-word {
      padding: 10px 18px;
      border: 2px solid #3b82f6;
      border-radius: 10px;
      background: #eff6ff;
      color: #1e40af;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .reorder-word:hover {
      background: #dbeafe;
      transform: translateY(-1px);
    }
    .reorder-word.used {
      opacity: 0.4;
      pointer-events: none;
      border-style: dashed;
    }
    .reorder-hint {
      margin-top: 20px;
      font-size: 15px;
      padding: 14px;
      background: #fef3c7;
      border-radius: 10px;
      border-left: 4px solid #f59e0b;
    }
    .reorder-clear {
      margin-top: 12px;
      padding: 8px 16px;
      font-size: 14px;
      background: #e5e7eb;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .reorder-clear:hover { background: #d1d5db; }

    /* ===== TYPE IN THE BLANK (g√µ t·ª´) ===== */
    .typeblank-sentence {
      font-size: 20px;
      line-height: 1.6;
      margin-bottom: 20px;
      padding: 15px;
      background: #f0fdf4;
      border-radius: 12px;
      border-left: 4px solid #10b981;
    }
    .typeblank-sentence .blank {
      display: inline-block;
      min-width: 80px;
      border-bottom: 2px solid #059669;
      margin: 0 4px;
      padding: 2px 8px;
      text-align: center;
    }
    .typeblank-input-wrap {
      margin: 20px 0;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
    }
    .typeblank-input {
      padding: 14px 20px;
      font-size: 18px;
      border: 2px solid #10b981;
      border-radius: 12px;
      min-width: 180px;
      flex: 1;
    }
    .typeblank-input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3);
    }
    .typeblank-input.correct { border-color: #059669; background: #d1fae5; }
    .typeblank-input.wrong { border-color: #dc2626; background: #fee2e2; }
    .typeblank-check {
      padding: 14px 28px;
      font-size: 16px;
      font-weight: 600;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }
    .typeblank-check:hover { opacity: 0.9; }
    .typeblank-check:disabled { opacity: 0.6; cursor: not-allowed; }

    /* ===== LESSON (Tab H·ªçc) ===== */
    .lesson-title {
      font-size: 26px;
      font-weight: 700;
      color: #1e40af;
      text-align: center;
      margin-bottom: 20px;
      line-height: 1.3;
      padding: 0 10px;
    }
    .lesson-section {
      margin-bottom: 22px;
      text-align: left;
    }
    .lesson-section-title {
      font-size: 15px;
      font-weight: 700;
      color: #3b82f6;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .lesson-definition {
      font-size: 15px;
      color: #374151;
      line-height: 1.6;
      padding: 14px;
      background: #f8fafc;
      border-radius: 10px;
      border-left: 4px solid #3b82f6;
    }
    .lesson-definition strong {
      color: #1e3a5f;
    }
    .lesson-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .lesson-table th {
      background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
      color: white;
      padding: 12px 10px;
      text-align: left;
      font-weight: 600;
    }
    .lesson-table td {
      padding: 10px;
      border-bottom: 1px solid #e5e7eb;
      color: #374151;
    }
    .lesson-table tr:nth-child(even) {
      background: #f9fafb;
    }
    .lesson-table tr:hover {
      background: #eff6ff;
    }
    .lesson-usage-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .lesson-usage-list li {
      padding: 8px 0 8px 24px;
      position: relative;
      font-size: 14px;
      color: #374151;
      line-height: 1.5;
    }
    .lesson-usage-list li::before {
      content: '‚úì';
      position: absolute;
      left: 0;
      color: #10b981;
      font-weight: 700;
    }
    .lesson-usage-list li .usage-en {
      display: block;
      font-size: 12px;
      color: #6b7280;
      margin-top: 4px;
      padding-left: 0;
      font-style: italic;
    }
    .lesson-signals {
      font-size: 14px;
      color: #1e40af;
      padding: 14px;
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      border-radius: 10px;
      font-weight: 600;
      line-height: 1.5;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .progress-bar-container {
      margin: 30px 0;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
    }

    .progress-bar-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 14px;
      color: #6b7280;
      font-weight: 600;
    }

    .progress-bar {
      height: 12px;
      background: #e5e7eb;
      border-radius: 6px;
      overflow: hidden;
      position: relative;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #1e40af);
      border-radius: 6px;
      transition: width 0.5s ease;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
    }

    .actions {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 30px;
    }

    .btn {
      padding: 18px 28px;
      border: none;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      box-sizing: border-box;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn:hover::before {
      width: 100px;
      height: 100px;
    }

    .btn:hover {
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .btn:active {
      transform: translateY(-1px) scale(0.98);
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
      color: white;
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }

    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
    }

    .btn-secondary {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      color: white;
    }

    .btn-info {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
    }

    .btn-reset {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
      margin-top: 8px;
    }

    .btn-reset:hover {
      background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
    }

    .btn-icon {
      margin-right: 8px;
      font-size: 20px;
    }

    .setting-reset {
      margin-top: 28px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
    }

    .setting-reset-desc {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 12px;
      line-height: 1.5;
    }

    .settings {
      padding: 30px;
      background: linear-gradient(to bottom, #f8f9fa, #ffffff);
      border-top: 2px solid #e9ecef;
    }

    .settings h3 {
      margin-bottom: 25px;
      color: #374151;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .setting-item {
      margin-bottom: 20px;
      padding: 15px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .setting-item label {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      font-size: 15px;
      color: #374151;
      font-weight: 500;
    }

    .setting-item input[type="checkbox"] {
      width: 22px;
      height: 22px;
      cursor: pointer;
      accent-color: #3b82f6;
    }

    .setting-item input[type="number"],
    .setting-item select {
      padding: 10px 15px;
      border: 2px solid #d1d5db;
      border-radius: 8px;
      width: 220px;
      font-size: 14px;
      margin-left: auto;
    }

    .shortcuts {
      text-align: center;
      color: #9ca3af;
      font-size: 13px;
      margin-top: 20px;
      padding: 15px;
      background: linear-gradient(135deg, #f8f9fa 0%, #f3f4f6 100%);
      border-radius: 10px;
      border: 1px solid #e5e7eb;
    }

    .shortcuts span {
      margin: 0 8px;
      padding: 4px 8px;
      background: white;
      border-radius: 6px;
      font-weight: 600;
    }

    .empty-state, .loading {
      text-align: center;
      padding: 80px 20px;
      color: #6b7280;
    }

    .empty-state h2, .loading h2 {
      font-size: 28px;
      margin-bottom: 15px;
      color: #374151;
    }

    .flip-animation {
      animation: cardFlip 0.6s ease-in-out;
    }

    @keyframes cardFlip {
      0% { transform: rotateY(0deg); opacity: 1; }
      50% { transform: rotateY(90deg); opacity: 0.5; }
      100% { transform: rotateY(0deg); opacity: 1; }
    }

    @media (max-width: 768px) {
      .term {
        font-size: 48px;
        padding: 15px 25px;
      }

      .ipa {
        font-size: 24px;
      }

      .meaning {
        font-size: 20px;
      }

      .actions {
        grid-template-columns: 1fr;
      }

      .stats-bar {
        grid-template-columns: repeat(2, 1fr);
      }

      .quiz-options {
        grid-template-columns: 1fr;
      }

      .lesson-title {
        font-size: 20px;
      }
      .lesson-table {
        font-size: 12px;
      }
      .lesson-table th,
      .lesson-table td {
        padding: 8px 6px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Learn English</h1>
      <div class="subtitle">Visual Learning App - Vocabulary, Grammar & Quiz</div>
    </div>

    <div class="stats-bar" id="statsBar">
      <div class="stat">
        <div class="stat-label">üìÖ Today</div>
        <div class="stat-value" id="todayCount">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">üî• Streak</div>
        <div class="stat-value" id="streak">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">‚úÖ Known</div>
        <div class="stat-value" id="knownCount">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">‚è∞ Due</div>
        <div class="stat-value" id="dueCount">0</div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" id="tabLearn" data-tab="learn">
        üìñ H·ªçc (Learn)
      </button>
      <button class="tab" id="tabPractice" data-tab="practice">
        üéØ Luy·ªán t·∫≠p (Practice)
      </button>
    </div>

    <div class="main-content">
      <!-- Tab 1: Learn (Ch·ªâ ƒë·ªçc th√¥ng tin) -->
      <div class="tab-content active" id="contentLearn">
        <div class="card-container">
          <div class="card" id="cardLearn">
            <div class="loading">
              <h2>Loading content...</h2>
            </div>
          </div>
        </div>

        <div class="actions" style="grid-template-columns: repeat(2, 1fr);">
          <button class="btn btn-info" id="speakLearnBtn">
            <span class="btn-icon">üîä</span> Speak
          </button>
          <button class="btn btn-primary" id="nextLearnBtn">
            <span class="btn-icon">‚û°Ô∏è</span> Next
          </button>
        </div>

        <div class="shortcuts">
          <strong>Keyboard Shortcuts:</strong>
          <span><strong>N</strong> Next</span>
          <span><strong>S</strong> Speak</span>
        </div>
      </div>

      <!-- Tab 2: Practice (C√≥ SRS, Known/Again) -->
      <div class="tab-content" id="contentPractice">
        <div class="practice-layout">
          <div class="practice-left">
            <div class="card-container">
              <div class="card" id="cardPractice">
                <div class="loading">
                  <h2>Loading content...</h2>
                </div>
              </div>
            </div>
            <div class="progress-bar-container" id="progressBarContainer" style="display: none;">
              <div class="progress-bar-label">
                <span>Progress</span>
                <span id="progressText">0%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-bar-fill" id="progressBarFill" style="width: 0%"></div>
              </div>
            </div>
          </div>
          <div class="practice-right">
            <div class="actions actions-sidebar">
              <button class="btn btn-info" id="speakPracticeBtn">
                <span class="btn-icon">üîä</span> Speak
              </button>
              <button class="btn btn-secondary" id="hintBtn">
                <span class="btn-icon">üí°</span> Hint
              </button>
              <button class="btn btn-danger" id="againBtn">
                <span class="btn-icon">‚ùå</span> Again
              </button>
              <button class="btn btn-success" id="knownBtn">
                <span class="btn-icon">‚úÖ</span> Known
              </button>
              <button class="btn btn-primary" id="nextPracticeBtn">
                <span class="btn-icon">‚û°Ô∏è</span> Next
              </button>
              <button class="btn btn-secondary" id="settingsBtn">
                <span class="btn-icon">‚öôÔ∏è</span> Settings
              </button>
            </div>
            <div class="shortcuts">
              <strong>Keyboard Shortcuts:</strong>
              <span><strong>N</strong> Next</span>
              <span><strong>Space</strong> Hint</span>
              <span><strong>Enter</strong> Known</span>
              <span><strong>Backspace</strong> Again</span>
              <span><strong>S</strong> Speak</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="settings" id="settingsPanel" style="display: none;">
      <h3>‚öôÔ∏è Settings</h3>
      <div class="setting-item">
        <label>
          <input type="checkbox" id="autoSpeakInput">
          Auto speak on next
        </label>
      </div>
      <div class="setting-item">
        <label>
          <input type="checkbox" id="reviewOnlyInput">
          Review only (due cards)
        </label>
      </div>
      <div class="setting-item">
        <label>
          Daily goal:
          <input type="number" id="dailyGoalInput" min="1" max="100" value="20">
        </label>
      </div>
      <div class="setting-item">
        <label>
          Lo·∫°i n·ªôi dung:
          <select id="contentTypeInput">
            <option value="all">T·∫•t c·∫£</option>
            <option value="word">T·ª´ v·ª±ng</option>
            <option value="grammar">Ng·ªØ ph√°p</option>
            <option value="quiz">C√¢u h·ªèi</option>
            <option value="fillblank">ƒêi·ªÅn t·ª´ (ch·ªçn ƒë√°p √°n)</option>
            <option value="typeblank">ƒêi·ªÅn t·ª´ (g√µ ƒë√°p √°n)</option>
            <option value="reorder">S·∫Øp x·∫øp l·∫°i c√¢u</option>
          </select>
        </label>
      </div>
      <div class="setting-item setting-reset">
        <p class="setting-reset-desc">X√≥a to√†n b·ªô ti·∫øn ƒë·ªô h·ªçc (Today, Known, Due) v√† b·∫Øt ƒë·∫ßu l·∫°i.</p>
        <button type="button" class="btn btn-reset" id="resetDataBtn">
          <span class="btn-icon">üîÑ</span> Reset d·ªØ li·ªáu
        </button>
      </div>
    </div>
  </div>

  <script>
    // ===== HELPERS =====
    function escapeHtml(s) {
      if (s == null) return '';
      return String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
    }

    // ===== CONFIG =====
    const SRS_INTERVALS_MS = [
      10 * 60 * 1000,    // 10m
      60 * 60 * 1000,    // 1h
      24 * 60 * 60 * 1000,  // 1d
      3 * 24 * 60 * 60 * 1000,  // 3d
      7 * 24 * 60 * 60 * 1000,  // 7d
      14 * 24 * 60 * 60 * 1000, // 14d
    ];

    // ===== STATE =====
    let allData = [];
    let learnData = [];  // N·ªôi dung ri√™ng cho tab H·ªçc (b√†i h·ªçc chi ti·∫øt)
    let currentItem = null;
    let currentLearnItem = null;
    let showHints = false;
    let autoSpeak = false;
    let dailyGoal = 20;
    let reviewOnly = false;
    let contentType = 'all';
    let currentTab = 'learn';
    let quizAnswered = false;
    let fillblankAnswered = false;
    let reorderChosen = [];
    let typeblankAnswered = false;

    // ===== UTILITIES =====
    function makeId(item) {
      if (item.id) return String(item.id);
      if (item.type === "lesson") return `lesson:${item.id || item.title || ""}`;
      if (item.type === "word") return `word:${item.term}:${item.ipa || ""}`;
      if (item.type === "grammar") return `grammar:${item.topic}:${item.formula || ""}`;
      if (item.type === "quiz") return `quiz:${item.question}:${(item.options || []).join("|")}`;
      if (item.type === "fillblank") return `fillblank:${(item.sentence || "").slice(0, 60)}:${(item.options || []).join("|")}`;
      if (item.type === "reorder") return `reorder:${(item.answer || item.sentence || "").slice(0, 60)}`;
      if (item.type === "typeblank") return `typeblank:${(item.sentence || "").slice(0, 60)}:${String(item.answer || "").slice(0, 30)}`;
      return `${item.type}:${JSON.stringify(item).slice(0, 80)}`;
    }

    function dayKey(d = new Date()) {
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      return `${yyyy}-${mm}-${dd}`;
    }

    // ===== STORAGE =====
    function loadProgress() {
      try {
        const data = localStorage.getItem('srsProgressById');
        return data ? JSON.parse(data) : {};
      } catch (e) {
        return {};
      }
    }

    function saveProgress(progressById) {
      try {
        localStorage.setItem('srsProgressById', JSON.stringify(progressById));
      } catch (e) {
        console.error('Failed to save progress:', e);
      }
    }

    function loadDailyProgress() {
      try {
        const data = localStorage.getItem('dailyProgress');
        return data ? JSON.parse(data) : { day: dayKey(), count: 0, streak: 0, lastDay: null };
      } catch (e) {
        return { day: dayKey(), count: 0, streak: 0, lastDay: null };
      }
    }

    function saveDailyProgress(dp) {
      try {
        localStorage.setItem('dailyProgress', JSON.stringify(dp));
      } catch (e) {
        console.error('Failed to save daily progress:', e);
      }
    }

    function loadSettings() {
      try {
        autoSpeak = localStorage.getItem('setting_autoSpeak') === 'true';
        reviewOnly = localStorage.getItem('setting_reviewOnly') === 'true';
        dailyGoal = parseInt(localStorage.getItem('setting_dailyGoal')) || 20;
        contentType = localStorage.getItem('setting_contentType') || 'all';
      } catch (e) {
        console.error('Failed to load settings:', e);
      }
    }

    function saveSettings() {
      try {
        localStorage.setItem('setting_autoSpeak', String(autoSpeak));
        localStorage.setItem('setting_reviewOnly', String(reviewOnly));
        localStorage.setItem('setting_dailyGoal', String(dailyGoal));
        localStorage.setItem('setting_contentType', contentType);
      } catch (e) {
        console.error('Failed to save settings:', e);
      }
    }

    // ===== DAILY PROGRESS =====
    function bumpDailyCount() {
      const key = dayKey();
      const dp = loadDailyProgress();

      if (dp.day !== key) {
        const prevDay = dp.day;
        const prevCount = dp.count || 0;
        const newStreak = prevCount > 0 && dp.lastDay === prevDay ? (dp.streak || 0) + 1 : prevCount > 0 ? 1 : 0;
        dp.day = key;
        dp.count = 0;
        dp.lastDay = prevDay;
        dp.streak = newStreak;
      }

      dp.count = (dp.count || 0) + 1;
      saveDailyProgress(dp);
      return dp;
    }

    function getDailyProgress() {
      const key = dayKey();
      const dp = loadDailyProgress();
      if (dp.day !== key) {
        return { day: key, count: 0, streak: dp.streak || 0, lastDay: dp.day || null };
      }
      return dp;
    }

    // ===== SRS =====
    function computeDueStats(items, progressById, now) {
      const knownIds = new Set();
      const dueIds = new Set();
      for (const item of items) {
        const id = makeId(item);
        const p = progressById[id];
        if (!p) continue;
        if (p.box >= 99) knownIds.add(id);
        if (p.nextDueMs != null && p.nextDueMs <= now && p.box < 99) dueIds.add(id);
      }
      return { due: dueIds.size, known: knownIds.size, total: items.length };
    }

    // ===== GET RANDOM ITEM =====
    function getRandomItem() {
      let data = allData;
      if (contentType !== 'all' && contentType !== 'random') {
        data = allData.filter(item => item.type === contentType);
      }
      if (data.length === 0) data = allData;

      const progressById = loadProgress();
      const now = Date.now();

      const dueItems = data.filter(item => {
        const p = progressById[makeId(item)];
        return p && p.box < 99 && p.nextDueMs != null && p.nextDueMs <= now;
      });

      const unseenItems = data.filter(item => !progressById[makeId(item)]);

      const pickFrom = dueItems.length
        ? dueItems
        : reviewOnly
          ? (unseenItems.length ? unseenItems : data)
          : unseenItems.length
            ? unseenItems
            : data;

      return pickFrom[Math.floor(Math.random() * pickFrom.length)];
    }

    // ===== GET LEARN ITEM (ch·ªâ d√πng cho tab H·ªçc - t·ª´ learn_content.json) =====
    function getLearnItem() {
      if (learnData.length === 0) return null;
      return learnData[Math.floor(Math.random() * learnData.length)];
    }

    // ===== SPEAK =====
    function speak(text, lang = 'en-US') {
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = lang;
        utterance.rate = 0.8;
        window.speechSynthesis.speak(utterance);
      }
    }

    // ===== RENDER LEARN TAB (Ch·ªâ ƒë·ªçc n·ªôi dung - d√πng learnData) =====
    function renderLearn(item) {
      const cardEl = document.getElementById('cardLearn');
      if (!item) {
        if (learnData.length === 0) {
          cardEl.innerHTML = '<div class="empty-state"><h2>Ch∆∞a c√≥ b√†i h·ªçc</h2><p>Vui l√≤ng th√™m file <code>data/learn_content.json</code></p></div>';
        } else {
          cardEl.innerHTML = '<div class="empty-state"><h2>Kh√¥ng c√≥ b√†i h·ªçc</h2><p>B·∫•m Next ƒë·ªÉ th·ª≠ l·∫°i.</p></div>';
        }
        return;
      }

      currentLearnItem = item;
      const card = document.getElementById('cardLearn');
      card.classList.add('flip-animation');
      setTimeout(() => card.classList.remove('flip-animation'), 600);

      let html = renderCardContent(item, false);
      document.getElementById('cardLearn').innerHTML = html;

      if (autoSpeak && item.type === 'lesson' && item.title) {
        setTimeout(() => speak(item.title), 300);
      }
    }

    // ===== RENDER PRACTICE TAB (C√≥ SRS) =====
    function renderPractice(item) {
      if (!item) {
        document.getElementById('cardPractice').innerHTML = '<div class="empty-state"><h2>No items found</h2><p>Please check your content.json file</p></div>';
        return;
      }

      currentItem = item;
      showHints = false;
      quizAnswered = false;
      fillblankAnswered = false;
      reorderChosen = [];
      typeblankAnswered = false;

      const progressById = loadProgress();
      const id = makeId(item);
      const progress = progressById[id];

      const card = document.getElementById('cardPractice');
      card.classList.add('flip-animation');
      setTimeout(() => card.classList.remove('flip-animation'), 600);

      let html = renderCardContent(item, true);
      
      if (progress) {
        const box = progress.box || 0;
        const progressPercent = Math.min((box / 6) * 100, 100);
        document.getElementById('progressBarContainer').style.display = 'block';
        document.getElementById('progressBarFill').style.width = progressPercent + '%';
        document.getElementById('progressText').textContent = Math.round(progressPercent) + '%';
      } else {
        document.getElementById('progressBarContainer').style.display = 'none';
      }

      document.getElementById('cardPractice').innerHTML = html;

      if (item.type === 'quiz') {
        setupQuizHandlers();
      } else if (item.type === 'fillblank') {
        setupFillblankHandlers();
      } else if (item.type === 'reorder') {
        setupReorderHandlers();
      } else if (item.type === 'typeblank') {
        setupTypeblankHandlers();
      }

      if (autoSpeak && item.type === 'word' && item.term) {
        setTimeout(() => speak(item.term), 300);
      }
    }

    // ===== SETUP QUIZ HANDLERS =====
    function setupQuizHandlers() {
      const options = document.querySelectorAll('.quiz-option');
      options.forEach((opt, idx) => {
        opt.addEventListener('click', () => {
          if (quizAnswered) return;
          quizAnswered = true;

          const correctIdx = currentItem.answer;
          
          // Mark clicked option
          if (idx === correctIdx) {
            opt.classList.add('correct');
          } else {
            opt.classList.add('wrong');
            // Always show correct answer when wrong
            if (options[correctIdx]) {
              options[correctIdx].classList.add('correct');
            }
          }

          // Always show explanation/hint (whether correct or wrong)
          const hintEl = document.getElementById('quizHint');
          if (hintEl) {
            let hintText = '';
            
            // If there's an explanation, show it
            if (currentItem.explain) {
              hintText = currentItem.explain;
            } else {
              // Otherwise, show the correct answer
              const correctAnswer = currentItem.options && currentItem.options[correctIdx] 
                ? currentItem.options[correctIdx] 
                : '';
              hintText = `ƒê√°p √°n ƒë√∫ng: ${correctAnswer}`;
            }
            
            hintEl.textContent = hintText;
            hintEl.classList.add('show');
          }
        });
      });
    }

    function setupFillblankHandlers() {
      const options = document.querySelectorAll('.fillblank-option');
      const hintEl = document.getElementById('fillblankHint');
      if (!currentItem || currentItem.type !== 'fillblank') return;
      options.forEach((opt, idx) => {
        opt.addEventListener('click', () => {
          if (fillblankAnswered) return;
          fillblankAnswered = true;
          const correctIdx = currentItem.answer;
          if (idx === correctIdx) {
            opt.classList.add('correct');
          } else {
            opt.classList.add('wrong');
            const correctOpt = options[correctIdx];
            if (correctOpt) correctOpt.classList.add('correct');
          }
          if (hintEl) {
            hintEl.textContent = currentItem.explain || 'ƒê√°p √°n: ' + (currentItem.options && currentItem.options[correctIdx] ? currentItem.options[correctIdx] : '');
            hintEl.classList.add('show');
          }
        });
      });
    }

    function shuffleArray(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function setupReorderHandlers() {
      if (!currentItem || currentItem.type !== 'reorder') return;
      const words = currentItem.words || [];
      const answer = currentItem.answer;
      const answerArr = Array.isArray(answer) ? answer : (typeof answer === 'string' ? answer.trim().split(/\s+/) : []);
      
      console.log('setupReorderHandlers called', { words, currentItem });
      
      // ƒê·∫£m b·∫£o DOM ƒë√£ s·∫µn s√†ng - d√πng requestAnimationFrame ƒë·ªÉ ƒë·∫£m b·∫£o DOM ƒë√£ render
      requestAnimationFrame(() => {
        setTimeout(() => {
          const container = document.getElementById('reorderWords');
          const answerArea = document.getElementById('reorderAnswerArea');
          const clearBtn = document.getElementById('reorderClearBtn');
          const hintEl = document.getElementById('reorderHint');
          
          console.log('setupReorderHandlers DOM check', { container, answerArea, words });
          
          if (!container || !answerArea) {
            console.error('Reorder: container or answerArea not found', { container, answerArea });
            return;
          }
          
          if (!words || words.length === 0) {
            console.error('Reorder: words array is empty', currentItem);
            container.innerHTML = '<p style="color: red;">L·ªói: Kh√¥ng c√≥ t·ª´ ƒë·ªÉ s·∫Øp x·∫øp</p>';
            return;
          }

          const shuffled = shuffleArray(words);
          reorderChosen = [];
          container.innerHTML = '';
          console.log('Rendering words:', shuffled);
          
          shuffled.forEach((w, i) => {
            const btn = document.createElement('span');
            btn.className = 'reorder-word';
            btn.textContent = w;
            btn.dataset.word = w;
            btn.addEventListener('click', () => {
              if (reorderChosen.indexOf(w) !== -1) return;
              reorderChosen.push(w);
              btn.classList.add('used');
              const span = document.createElement('span');
              span.className = 'reorder-word';
              span.textContent = w;
              span.style.cursor = 'default';
              span.style.pointerEvents = 'none';
              answerArea.appendChild(span);
              answerArea.classList.add('filled');
              if (reorderChosen.length === words.length) {
                const userStr = reorderChosen.join(' ').toLowerCase().replace(/\s+/g, ' ').trim();
                const correctStr = answerArr.join(' ').toLowerCase().replace(/\s+/g, ' ').trim();
                const isCorrect = userStr === correctStr;
                
                // Hi·ªÉn th·ªã ƒë√∫ng/sai v·ªõi m√†u s·∫Øc
                if (isCorrect) {
                  answerArea.style.borderColor = '#10b981';
                  answerArea.style.backgroundColor = '#d1fae5';
                } else {
                  answerArea.style.borderColor = '#ef4444';
                  answerArea.style.backgroundColor = '#fee2e2';
                }
                
                if (hintEl) {
                  if (isCorrect) {
                    // ƒê√∫ng: Hi·ªÉn th·ªã c√¢u ho√†n ch·ªânh + ki·∫øn th·ª©c
                    let message = '‚úì ƒê√∫ng r·ªìi!\n\n';
                    
                    // C√¢u ho√†n ch·ªânh
                    message += 'üìù C√¢u ho√†n ch·ªânh: ' + answerArr.join(' ') + '\n';
                    
                    // D·ªãch ti·∫øng Vi·ªát (n·∫øu c√≥)
                    if (currentItem.vietnameseSentence) {
                      message += 'üîÑ D·ªãch nghƒ©a: ' + currentItem.vietnameseSentence + '\n';
                    }
                    
                    // Gi·∫£i th√≠ch ng·ªØ ph√°p (n·∫øu c√≥)
                    if (currentItem.explain) {
                      message += 'üí° Gi·∫£i th√≠ch: ' + currentItem.explain;
                    } else if (currentItem.tenseHint) {
                      message += 'üí° Th√¨: ' + currentItem.tenseHint;
                    }
                    
                    hintEl.textContent = message;
                  } else {
                    // Sai: Ch·ªâ hi·ªán ƒë√°p √°n ƒë√∫ng
                    hintEl.textContent = '‚úó Sai r·ªìi! ƒê√°p √°n ƒë√∫ng: ' + answerArr.join(' ');
                  }
                  
                  hintEl.classList.add('show');
                  hintEl.style.color = isCorrect ? '#059669' : '#dc2626';
                  hintEl.style.fontWeight = '600';
                  hintEl.style.whiteSpace = 'pre-line';
                }
              }
            });
            container.appendChild(btn);
          });
          
          console.log('Words rendered, container children:', container.children.length);

          if (clearBtn) {
            // Remove old listeners by cloning
            const newClearBtn = clearBtn.cloneNode(true);
            clearBtn.parentNode.replaceChild(newClearBtn, clearBtn);
            
            newClearBtn.addEventListener('click', () => {
              reorderChosen = [];
              answerArea.innerHTML = '';
              answerArea.classList.remove('filled');
              // Reset m√†u v·ªÅ m·∫∑c ƒë·ªãnh
              answerArea.style.borderColor = '#cbd5e1';
              answerArea.style.backgroundColor = '#f8fafc';
              container.querySelectorAll('.reorder-word.used').forEach(el => el.classList.remove('used'));
              // ·∫®n hint
              if (hintEl) {
                hintEl.classList.remove('show');
                hintEl.style.color = '';
                hintEl.style.fontWeight = '';
              }
            });
          }
        }, 50);
      });
    }

    function setupTypeblankHandlers() {
      if (!currentItem || currentItem.type !== 'typeblank') return;
      const inputEl = document.getElementById('typeblankInput');
      const checkBtn = document.getElementById('typeblankCheckBtn');
      const hintEl = document.getElementById('typeblankHint');
      if (!inputEl || !checkBtn) return;

      const check = () => {
        if (typeblankAnswered) return;
        const raw = (inputEl.value || '').trim();
        const user = raw.toLowerCase().replace(/\s+/g, ' ');
        const answer = currentItem.answer;
        const accepted = Array.isArray(answer) ? answer : [answer];
        const normalized = accepted.map(a => String(a).toLowerCase().trim());
        const correct = normalized.some(a => a === user);

        typeblankAnswered = true;
        inputEl.disabled = true;
        checkBtn.disabled = true;
        if (correct) {
          inputEl.classList.add('correct');
        } else {
          inputEl.classList.add('wrong');
        }
        if (hintEl) {
          hintEl.textContent = (correct ? 'ƒê√∫ng r·ªìi! ' : 'ƒê√°p √°n: ') + (currentItem.explain || (Array.isArray(answer) ? answer.join(' / ') : answer));
          hintEl.classList.add('show');
        }
      };

      checkBtn.addEventListener('click', check);
      inputEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') check(); });
    }

    // ===== FORMAT ƒê·ªäNH NGHƒ®A: xu·ªëng d√≤ng + bold cho t·∫•t c·∫£ c√°c ki·ªÉu m·ª•c =====
    function formatDefinition(text) {
      if (!text || typeof text !== 'string') return '';
      const escape = (s) => String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
      const raw = text.trim();

      // Ki·ªÉu 1: (1), (2), (3) ...
      let parts = raw.split(/\s*\(\d{1,2}\)\s*/);
      if (parts.length > 1) {
        let result = escape(parts[0].trim());
        for (let i = 1; i < parts.length; i++) {
          result += '<br><strong>(' + i + ') ' + escape(parts[i].trim()).replace(/\n/g, '<br>') + '</strong>';
        }
        return result;
      }

      // Ki·ªÉu 2: "At: ... . On: ... . In: ..." (ch·∫•m c√°ch r·ªìi m·ª•c m·ªõi b·∫Øt ƒë·∫ßu b·∫±ng Ch·ªØ:)
      parts = raw.split(/\.\s+(?=[A-Za-z][a-z]*:)/);
      if (parts.length > 1) {
        let result = '';
        parts.forEach((p) => {
          p = p.trim();
          if (!p) return;
          const m = p.match(/^([^:]+):\s*(.*)$/s);
          if (m) {
            result += (result ? '<br>' : '') + '<strong>' + escape(m[1].trim()) + ':</strong> ' + escape(m[2].trim()).replace(/\n/g, '<br>');
          } else {
            result += (result ? '<br>' : '') + escape(p).replace(/\n/g, '<br>');
          }
        });
        return result;
      }

      // Ki·ªÉu 3: Nhi·ªÅu m·ª•c t√°ch b·∫±ng ". " ho·∫∑c "? " ho·∫∑c "! " (c√¢u k·∫øt th√∫c b·∫±ng ch·∫•m / ch·∫•m h·ªèi / ch·∫•m than)
      const bySentence = raw.split(/[.?!]\s+/).map(s => s.trim()).filter(Boolean);
      if (bySentence.length > 1) {
        let result = '';
        bySentence.forEach((p) => {
          p = p.trim();
          if (!p) return;
          const m = p.match(/^([^:]+):\s*(.*)$/s);
          if (m) {
            const content = m[2].trim();
            // Trong n·ªôi dung, n·∫øu c√≥ "; " th√¨ xu·ªëng d√≤ng t·ª´ng √Ω
            const subParts = content.split(/\s*;\s*/).map(s => s.trim()).filter(Boolean);
            const contentStr = subParts.length > 1
              ? subParts.map((s, i) => (i === 0 ? escape(s) : '‚Ä¢ ' + escape(s))).join('<br>')
              : escape(content).replace(/\n/g, '<br>');
            result += (result ? '<br>' : '') + '<strong>' + escape(m[1].trim()) + ':</strong> ' + contentStr;
          } else {
            result += (result ? '<br>' : '') + escape(p).replace(/\n/g, '<br>');
          }
        });
        return result;
      }

      // Ki·ªÉu 4: M·ªôt c√¢u d√†i c√≥ "; " (ch·∫•m ph·∫©y) t√°ch nhi·ªÅu √Ω ‚Äî xu·ªëng d√≤ng t·ª´ng √Ω
      if (raw.includes(';')) {
        parts = raw.split(/\s*;\s*/).map(s => s.trim()).filter(Boolean);
        if (parts.length > 1) {
          const first = parts[0];
          const m = first.match(/^([^:]+):\s*(.*)$/s);
          let result = '';
          if (m) {
            result = '<strong>' + escape(m[1].trim()) + ':</strong> ' + escape(m[2].trim());
            for (let i = 1; i < parts.length; i++) {
              const pm = parts[i].match(/^([^:]+):\s*(.*)$/s);
              if (pm) {
                result += '<br><strong>' + escape(pm[1].trim()) + ':</strong> ' + escape(pm[2].trim());
              } else {
                result += '<br>‚Ä¢ ' + escape(parts[i]);
              }
            }
          } else {
            result = parts.map((p, i) => (i === 0 ? escape(p) : '‚Ä¢ ' + escape(p))).join('<br>');
          }
          return result.replace(/\n/g, '<br>');
        }
      }

      // Ki·ªÉu 5: "X: ... ‚Äî Y: ..." ho·∫∑c "X: ... ‚Äì Y: ..." (g·∫°ch ngang t√°ch m·ª•c)
      const byDash = raw.split(/\s*[‚Äî‚Äì]\s+/);
      if (byDash.length > 1) {
        let result = '';
        byDash.forEach((p) => {
          p = p.trim();
          if (!p) return;
          const m = p.match(/^([^:]+):\s*(.*)$/s);
          if (m) {
            result += (result ? '<br>' : '') + '<strong>' + escape(m[1].trim()) + ':</strong> ' + escape(m[2].trim()).replace(/\n/g, '<br>');
          } else {
            result += (result ? '<br>' : '') + escape(p).replace(/\n/g, '<br>');
          }
        });
        return result;
      }

      return escape(raw).replace(/\n/g, '<br>');
    }

    // ===== RENDER CARD CONTENT (D√πng chung) =====
    function renderCardContent(item, showProgress = false) {
      let html = '';

      if (item.type === 'lesson') {
        // Tab H·ªçc: b√†i h·ªçc chi ti·∫øt (c√°c th√¨, c√¥ng th·ª©c, v√≠ d·ª•, d·∫•u hi·ªáu)
        html += `<div class="lesson-title">${item.title || ''}</div>`;

        if (item.definition) {
          html += '<div class="lesson-section">';
          html += '<div class="lesson-section-title">üìå ƒê·ªãnh nghƒ©a</div>';
          html += '<div class="lesson-definition">' + formatDefinition(item.definition) + '</div>';
          html += '</div>';
        }

        if (item.formula && item.formula.headers && item.formula.rows) {
          html += '<div class="lesson-section">';
          html += '<div class="lesson-section-title">üìê C√¥ng th·ª©c</div>';
          html += '<div style="overflow-x: auto;"><table class="lesson-table">';
          html += '<thead><tr>';
          item.formula.headers.forEach(h => { html += `<th>${h}</th>`; });
          html += '</tr></thead><tbody>';
          item.formula.rows.forEach(row => {
            html += '<tr>';
            row.forEach(cell => { html += `<td>${cell}</td>`; });
            html += '</tr>';
          });
          html += '</tbody></table></div>';
          html += '</div>';
        }

        if (item.examples && item.examples.headers && item.examples.rows) {
          html += '<div class="lesson-section">';
          html += '<div class="lesson-section-title">üí° V√≠ d·ª•</div>';
          html += '<div style="overflow-x: auto;"><table class="lesson-table">';
          html += '<thead><tr>';
          item.examples.headers.forEach(h => { html += `<th>${h}</th>`; });
          html += '</tr></thead><tbody>';
          item.examples.rows.forEach(row => {
            html += '<tr>';
            row.forEach(cell => { html += `<td>${cell}</td>`; });
            html += '</tr>';
          });
          html += '</tbody></table></div>';
          html += '</div>';
        }

        if (item.usage && Array.isArray(item.usage) && item.usage.length > 0) {
          html += '<div class="lesson-section">';
          html += '<div class="lesson-section-title">üìñ C√°ch d√πng</div>';
          html += '<ul class="lesson-usage-list">';
          const usageEn = item.usageEn && Array.isArray(item.usageEn) ? item.usageEn : [];
          item.usage.forEach((u, i) => {
            const en = usageEn[i] ? `<span class="usage-en">${escapeHtml(usageEn[i])}</span>` : '';
            html += `<li>${escapeHtml(u)}${en}</li>`;
          });
          html += '</ul>';
          html += '</div>';
        }

        if (item.signals) {
          html += '<div class="lesson-section">';
          html += '<div class="lesson-section-title">üîç D·∫•u hi·ªáu nh·∫≠n bi·∫øt</div>';
          html += `<div class="lesson-signals">${item.signals}</div>`;
          html += '</div>';
        }

        return html;
      }

      if (item.type === 'word') {
        html += '<div class="term-container">';
        html += `<div class="term">${item.term || ''}`;
        if (item.level) {
          html += `<span class="level-badge level-${item.level}">${item.level}</span>`;
        }
        html += '</div>';
        html += '</div>';
        
        html += '<div class="ipa-container">';
        if (item.ipa) {
          html += '<div class="ipa">';
          html += `<span class="ipa-text">${item.ipa}</span>`;
          html += '</div>';
        }
        html += '</div>';
        
        html += '<div class="meaning-container">';
        html += `<div class="meaning">${item.meaning || ''}</div>`;
        html += '</div>';
        
        if (item.example) {
          html += `<div class="example">${item.example}</div>`;
        }
      } else if (item.type === 'grammar') {
        html += '<div class="term-container">';
        html += `<div class="term" style="font-size: 48px;">${escapeHtml(item.topic || '')}</div>`;
        if (item.topicVi) {
          html += `<div class="grammar-vi">${escapeHtml(item.topicVi)}</div>`;
        }
        html += '</div>';
        
        html += '<div class="grammar-formula">';
        html += `<div>${escapeHtml(item.formula || '')}</div>`;
        html += '</div>';
        
        html += '<div class="grammar-info">';
        html += `<strong>Usage:</strong> ${escapeHtml(item.use || '')}`;
        if (item.useVi) {
          html += `<span class="grammar-vi"> ${escapeHtml(item.useVi)}</span>`;
        }
        html += '</div>';
        
        if (item.signal) {
          html += '<div class="grammar-info">';
          html += `<strong>Signal words:</strong> ${escapeHtml(item.signal || '')}`;
          if (item.signalVi) {
            html += `<span class="grammar-vi"> ${escapeHtml(item.signalVi)}</span>`;
          }
          html += '</div>';
        }
        
        if (item.example) {
          html += `<div class="example">${escapeHtml(item.example)}`;
          if (item.exampleVi) {
            html += `<div class="grammar-vi">${escapeHtml(item.exampleVi)}</div>`;
          }
          html += '</div>';
        }
      } else if (item.type === 'quiz') {
        html += '<div class="term-container">';
        html += `<div class="term" style="font-size: 32px;">Quick Quiz</div>`;
        html += '</div>';
        
        html += '<div class="meaning-container">';
        html += `<div class="meaning" style="font-size: 20px;">${item.question || ''}</div>`;
        html += '</div>';
        
        if (item.options && Array.isArray(item.options)) {
          html += '<div class="quiz-options">';
          item.options.forEach((opt, i) => {
            html += `<div class="quiz-option" data-index="${i}">${opt}</div>`;
          });
          html += '</div>';
        }
        
        html += `<div class="hint" id="quizHint"></div>`;
      } else if (item.type === 'fillblank') {
        html += '<div class="term-container">';
        html += `<div class="term" style="font-size: 28px;">ƒêi·ªÅn t·ª´ v√†o ch·ªó tr·ªëng</div>`;
        html += '</div>';
        // Hi·ªÉn th·ªã baseForm n·∫øu c√≥ (d·∫°ng chia ƒë√∫ng t·ª´ nguy√™n th·ªÉ)
        if (item.baseForm) {
          html += `<div class="base-form-hint" style="margin-bottom: 16px; padding: 12px; background: #e0f2fe; border-left: 4px solid #0284c7; border-radius: 8px; font-size: 16px; color: #0c4a6e;">`;
          html += `<strong>Chia ƒë√∫ng d·∫°ng c·ªßa t·ª´:</strong> <span style="font-weight: 600; color: #0369a1;">${escapeHtml(item.baseForm)}</span>`;
          // Hi·ªÉn th·ªã g·ª£i √Ω th√¨ n·∫øu c√≥
          if (item.tenseHint) {
            html += ` <span style="color: #0c4a6e; margin-left: 8px;">‚Üí ${escapeHtml(item.tenseHint)}</span>`;
          }
          html += '</div>';
          // Hi·ªÉn th·ªã c√¢u ti·∫øng Vi·ªát n·∫øu c√≥ baseForm
          if (item.vietnameseSentence) {
            html += `<div class="vietnamese-hint" style="margin-bottom: 16px; padding: 12px; background: #fef3c7; border-left: 4px solid #d97706; border-radius: 8px; font-size: 16px; color: #78350f;">`;
            html += `<strong>C√¢u ti·∫øng Vi·ªát:</strong> <span style="font-weight: 500;">${escapeHtml(item.vietnameseSentence)}</span>`;
            html += '</div>';
          }
        } else if (item.vietnameseSentence) {
          // N·∫øu ch·ªâ c√≥ vietnameseSentence (kh√¥ng c√≥ baseForm) - d·∫°ng d·ªãch
          html += `<div class="vietnamese-hint" style="margin-bottom: 16px; padding: 12px; background: #fef3c7; border-left: 4px solid #d97706; border-radius: 8px; font-size: 16px; color: #78350f;">`;
          html += `<strong>D·ªãch sang ti·∫øng Anh:</strong> <span style="font-weight: 500;">${escapeHtml(item.vietnameseSentence)}</span>`;
          html += '</div>';
        }
        const sent = escapeHtml(item.sentence || '').replace(/___+/g, '<span class="blank">&nbsp;&nbsp;&nbsp;</span>');
        html += `<div class="fillblank-sentence">${sent}</div>`;
        if (item.options && Array.isArray(item.options)) {
          html += '<div class="fillblank-options">';
          item.options.forEach((opt, i) => {
            html += `<div class="fillblank-option" data-index="${i}">${escapeHtml(opt)}</div>`;
          });
          html += '</div>';
        }
        html += `<div class="hint" id="fillblankHint"></div>`;
      } else if (item.type === 'reorder') {
        html += '<div class="term-container">';
        html += `<div class="term" style="font-size: 28px;">S·∫Øp x·∫øp l·∫°i c√¢u</div>`;
        html += '</div>';
        html += '<p class="reorder-instruction">Click c√°c t·ª´ theo th·ª© t·ª± ƒë√∫ng ƒë·ªÉ t·∫°o c√¢u ho√†n ch·ªânh.</p>';
        html += '<div class="reorder-answer-area" id="reorderAnswerArea"></div>';
        html += '<button type="button" class="reorder-clear" id="reorderClearBtn">X√≥a / L√†m l·∫°i</button>';
        html += '<div class="reorder-words" id="reorderWords"></div>';
        html += `<div class="hint" id="reorderHint"></div>`;
      } else if (item.type === 'typeblank') {
        html += '<div class="term-container">';
        html += `<div class="term" style="font-size: 28px;">G√µ t·ª´ v√†o ch·ªó tr·ªëng</div>`;
        html += '</div>';
        // Hi·ªÉn th·ªã baseForm n·∫øu c√≥ (d·∫°ng chia ƒë√∫ng t·ª´ nguy√™n th·ªÉ)
        if (item.baseForm) {
          html += `<div class="base-form-hint" style="margin-bottom: 16px; padding: 12px; background: #e0f2fe; border-left: 4px solid #0284c7; border-radius: 8px; font-size: 16px; color: #0c4a6e;">`;
          html += `<strong>Chia ƒë√∫ng d·∫°ng c·ªßa t·ª´:</strong> <span style="font-weight: 600; color: #0369a1;">${escapeHtml(item.baseForm)}</span>`;
          // Hi·ªÉn th·ªã g·ª£i √Ω th√¨ n·∫øu c√≥
          if (item.tenseHint) {
            html += ` <span style="color: #0c4a6e; margin-left: 8px;">‚Üí ${escapeHtml(item.tenseHint)}</span>`;
          }
          html += '</div>';
          // Hi·ªÉn th·ªã c√¢u ti·∫øng Vi·ªát n·∫øu c√≥ baseForm
          if (item.vietnameseSentence) {
            html += `<div class="vietnamese-hint" style="margin-bottom: 16px; padding: 12px; background: #fef3c7; border-left: 4px solid #d97706; border-radius: 8px; font-size: 16px; color: #78350f;">`;
            html += `<strong>C√¢u ti·∫øng Vi·ªát:</strong> <span style="font-weight: 500;">${escapeHtml(item.vietnameseSentence)}</span>`;
            html += '</div>';
          }
        } else if (item.vietnameseSentence) {
          // N·∫øu ch·ªâ c√≥ vietnameseSentence (kh√¥ng c√≥ baseForm) - d·∫°ng d·ªãch
          html += `<div class="vietnamese-hint" style="margin-bottom: 16px; padding: 12px; background: #fef3c7; border-left: 4px solid #d97706; border-radius: 8px; font-size: 16px; color: #78350f;">`;
          html += `<strong>D·ªãch sang ti·∫øng Anh:</strong> <span style="font-weight: 500;">${escapeHtml(item.vietnameseSentence)}</span>`;
          html += '</div>';
        }
        const sent = escapeHtml(item.sentence || '').replace(/___+/g, '<span class="blank">&nbsp;&nbsp;&nbsp;</span>');
        html += `<div class="typeblank-sentence">${sent}</div>`;
        html += '<div class="typeblank-input-wrap">';
        html += '<input type="text" class="typeblank-input" id="typeblankInput" placeholder="G√µ ƒë√°p √°n..." autocomplete="off">';
        html += '<button type="button" class="typeblank-check" id="typeblankCheckBtn">Ki·ªÉm tra</button>';
        html += '</div>';
        html += `<div class="hint" id="typeblankHint"></div>`;
      }

      return html;
    }

    // ===== ACTIONS =====
    function markKnown() {
      if (!currentItem) return;

      const progressById = loadProgress();
      const id = makeId(currentItem);
      const progress = progressById[id] || { box: 0, nextDueMs: null };
      const now = Date.now();

      // M·ªôt l·∫ßn b·∫•m Known = ƒë√°nh d·∫•u ƒë√£ bi·∫øt ngay (box 99), b·ªô ƒë·∫øm Known tƒÉng ngay
      progress.box = 99;
      progress.nextDueMs = null;

      progressById[id] = progress;
      saveProgress(progressById);

      bumpDailyCount();
      updateStats();
      loadNextPractice();
    }

    function markAgain() {
      if (!currentItem) return;

      const progressById = loadProgress();
      const id = makeId(currentItem);
      const progress = progressById[id] || { box: 0, nextDueMs: null };
      const now = Date.now();

      progress.box = 0;
      progress.nextDueMs = now + SRS_INTERVALS_MS[0];

      progressById[id] = progress;
      saveProgress(progressById);

      bumpDailyCount();
      updateStats();
      loadNextPractice();
    }

    function loadNextLearn() {
      const item = getLearnItem();
      renderLearn(item);
      document.getElementById('tabLearn').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function loadNextPractice() {
      const item = getRandomItem();
      renderPractice(item);
      document.getElementById('tabPractice').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function toggleHint() {
      if (currentItem && currentItem.type === 'quiz') {
        const hintEl = document.getElementById('quizHint');
        if (hintEl) {
          if (!hintEl.classList.contains('show')) {
            hintEl.textContent = currentItem.explain || `Answer: ${currentItem.options?.[currentItem.answer] || ''}`;
          }
          hintEl.classList.toggle('show');
        }
      } else if (currentItem && currentItem.type === 'fillblank') {
        const hintEl = document.getElementById('fillblankHint');
        if (hintEl) {
          if (!hintEl.classList.contains('show')) {
            const correct = currentItem.options && currentItem.options[currentItem.answer];
            hintEl.textContent = currentItem.explain || ('ƒê√°p √°n: ' + (correct || ''));
          }
          hintEl.classList.toggle('show');
        }
      } else if (currentItem && currentItem.type === 'reorder') {
        const hintEl = document.getElementById('reorderHint');
        if (hintEl) {
          if (!hintEl.classList.contains('show')) {
            const ans = currentItem.answer;
            hintEl.textContent = currentItem.explain || ('ƒê√°p √°n: ' + (Array.isArray(ans) ? ans.join(' ') : ans));
          }
          hintEl.classList.toggle('show');
        }
      } else if (currentItem && currentItem.type === 'typeblank') {
        const hintEl = document.getElementById('typeblankHint');
        if (hintEl) {
          if (!hintEl.classList.contains('show')) {
            const ans = currentItem.answer;
            hintEl.textContent = currentItem.explain || ('ƒê√°p √°n: ' + (Array.isArray(ans) ? ans.join(' / ') : ans));
          }
          hintEl.classList.toggle('show');
        }
      } else {
        showHints = !showHints;
      }
    }

    function updateStats() {
      const dp = getDailyProgress();
      document.getElementById('todayCount').textContent = dp.count || 0;
      document.getElementById('streak').textContent = dp.streak || 0;

      const progressById = loadProgress();
      const now = Date.now();
      const stats = computeDueStats(allData, progressById, now);
      document.getElementById('knownCount').textContent = stats.known || 0;
      document.getElementById('dueCount').textContent = stats.due || 0;
    }

    // ===== INIT =====
    async function init() {
      try {
        const paths = [
          './data/content.json',
          'data/content.json',
          '../data/content.json',
          './content.json'
        ];

        let loaded = false;
        for (const path of paths) {
          try {
            const response = await fetch(path);
            if (response.ok) {
              allData = await response.json();
              if (Array.isArray(allData)) {
                loaded = true;
                console.log(`Loaded content.json from: ${path}`);
                break;
              }
            }
          } catch (e) {
            console.log(`Failed to load from ${path}:`, e.message);
          }
        }

        if (!loaded) {
          throw new Error('Cannot load content.json. Please use a local web server.');
        }

        // Load n·ªôi dung ri√™ng cho tab H·ªçc (b√†i h·ªçc chi ti·∫øt)
        const learnPaths = ['./data/learn_content.json', 'data/learn_content.json', '../data/learn_content.json'];
        for (const path of learnPaths) {
          try {
            const learnRes = await fetch(path);
            if (learnRes.ok) {
              const data = await learnRes.json();
              if (Array.isArray(data)) {
                learnData = data.filter(item => item.type === 'lesson');
                console.log(`Loaded learn_content.json from: ${path} (${learnData.length} lessons)`);
                break;
              }
            }
          } catch (e) {
            console.log(`Failed to load learn_content from ${path}:`, e.message);
          }
        }

        loadSettings();
        document.getElementById('autoSpeakInput').checked = autoSpeak;
        document.getElementById('reviewOnlyInput').checked = reviewOnly;
        document.getElementById('dailyGoalInput').value = dailyGoal;
        document.getElementById('contentTypeInput').value = contentType;

        updateStats();
        loadNext();
      } catch (error) {
        console.error('Init error:', error);
        const isFileProtocol = window.location.protocol === 'file:';
        const errorMsg = isFileProtocol 
          ? `<h2>‚ö†Ô∏è CORS Error - Need Local Server</h2>
             <p><strong>Browsers block loading local files for security.</strong></p>
             <p style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px;">
               <strong>Solution:</strong> Use a local web server:<br><br>
               <strong>Python:</strong><br>
               <code style="background: #f8f9fa; padding: 5px 10px; border-radius: 4px;">cd c:\\Users\\Tester\\python\\new\\learn_english<br>python -m http.server 8000</code><br><br>
               Then open: <code style="background: #f8f9fa; padding: 5px 10px; border-radius: 4px;">http://localhost:8000/app.html</code>
             </p>`
          : `<h2>Error loading content</h2>
             <p>Please make sure <code>data/content.json</code> exists</p>
             <p style="color: #6c757d; font-size: 14px;">Error: ${error.message}</p>`;
        
        document.getElementById('cardLearn').innerHTML = 
          `<div class="empty-state">${errorMsg}</div>`;
        document.getElementById('cardPractice').innerHTML = 
          `<div class="empty-state">${errorMsg}</div>`;
      }
    }

    function loadNext() {
      if (currentTab === 'learn') {
        loadNextLearn();
      } else {
        loadNextPractice();
      }
    }

    // ===== TAB SWITCHING =====
    function switchTab(tabName) {
      currentTab = tabName;
      
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.getElementById(`tab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).classList.add('active');
      
      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`content${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).classList.add('active');
      
      // Show/hide stats bar (ch·ªâ hi·ªán ·ªü Practice tab)
      document.getElementById('statsBar').style.display = tabName === 'practice' ? 'grid' : 'none';
      
      // Load content for current tab
      if (tabName === 'learn') {
        loadNextLearn();
      } else {
        updateStats(); // C·∫≠p nh·∫≠t s·ªë li·ªáu khi m·ªü tab Luy·ªán t·∫≠p
        loadNextPractice();
      }
    }

    // ===== EVENT LISTENERS =====
    // Tab switching
    document.getElementById('tabLearn').addEventListener('click', () => switchTab('learn'));
    document.getElementById('tabPractice').addEventListener('click', () => switchTab('practice'));
    
    // Learn tab buttons
    document.getElementById('nextLearnBtn').addEventListener('click', loadNextLearn);
    document.getElementById('speakLearnBtn').addEventListener('click', () => {
      if (currentLearnItem) {
        if (currentLearnItem.type === 'lesson' && currentLearnItem.title) {
          speak(currentLearnItem.title, 'en-US');
        } else if (currentLearnItem.type === 'word' && currentLearnItem.term) {
          speak(currentLearnItem.term);
        } else if (currentLearnItem.type === 'grammar' && currentLearnItem.example) {
          speak(currentLearnItem.example);
        }
      }
    });
    
    // Practice tab buttons
    document.getElementById('nextPracticeBtn').addEventListener('click', loadNextPractice);
    document.getElementById('knownBtn').addEventListener('click', markKnown);
    document.getElementById('againBtn').addEventListener('click', markAgain);
    document.getElementById('hintBtn').addEventListener('click', toggleHint);
    document.getElementById('speakPracticeBtn').addEventListener('click', () => {
      if (currentItem) {
        if (currentItem.type === 'word' && currentItem.term) {
          speak(currentItem.term);
        } else if (currentItem.type === 'grammar' && currentItem.example) {
          speak(currentItem.example);
        } else if (currentItem.type === 'fillblank' && currentItem.sentence) {
          const ans = currentItem.options && currentItem.options[currentItem.answer];
          speak((currentItem.sentence || '').replace(/___+/g, ans || ''));
        } else if (currentItem.type === 'typeblank' && currentItem.sentence) {
          const ans = Array.isArray(currentItem.answer) ? currentItem.answer[0] : currentItem.answer;
          speak((currentItem.sentence || '').replace(/___+/g, ans || ''));
        } else if (currentItem.type === 'reorder' && currentItem.answer) {
          const s = Array.isArray(currentItem.answer) ? currentItem.answer.join(' ') : currentItem.answer;
          speak(s);
        }
      }
    });

    document.getElementById('settingsBtn').addEventListener('click', () => {
      const panel = document.getElementById('settingsPanel');
      panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    });

    document.getElementById('autoSpeakInput').addEventListener('change', (e) => {
      autoSpeak = e.target.checked;
      saveSettings();
    });

    document.getElementById('reviewOnlyInput').addEventListener('change', (e) => {
      reviewOnly = e.target.checked;
      saveSettings();
    });

    document.getElementById('dailyGoalInput').addEventListener('change', (e) => {
      dailyGoal = parseInt(e.target.value) || 20;
      saveSettings();
    });

    document.getElementById('contentTypeInput').addEventListener('change', (e) => {
      contentType = e.target.value;
      saveSettings();
      if (currentTab === 'learn') {
        loadNextLearn();
      } else {
        loadNextPractice();
      }
    });

    document.getElementById('resetDataBtn').addEventListener('click', () => {
      if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô ti·∫øn ƒë·ªô h·ªçc?\n\nToday, Known, Due s·∫Ω v·ªÅ 0. C√†i ƒë·∫∑t (Auto speak, Daily goal...) ƒë∆∞·ª£c gi·ªØ nguy√™n.')) return;
      try {
        localStorage.removeItem('srsProgressById');
        localStorage.removeItem('dailyProgress');
        updateStats();
        if (currentTab === 'learn') loadNextLearn();
        else loadNextPractice();
        document.getElementById('settingsPanel').style.display = 'none';
        alert('ƒê√£ x√≥a ti·∫øn ƒë·ªô. B·∫°n c√≥ th·ªÉ b·∫Øt ƒë·∫ßu l·∫°i t·ª´ ƒë·∫ßu.');
      } catch (e) {
        console.error('Reset failed:', e);
        alert('Kh√¥ng th·ªÉ x√≥a d·ªØ li·ªáu. Th·ª≠ l·∫°i sau.');
      }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;

      if (currentTab === 'learn') {
        // Learn tab shortcuts
        if (e.key === 'n' || e.key === 'N') {
          loadNextLearn();
        } else         if (e.key === 's' || e.key === 'S') {
          if (currentLearnItem) {
            if (currentLearnItem.type === 'lesson' && currentLearnItem.title) {
              speak(currentLearnItem.title, 'en-US');
            } else if (currentLearnItem.type === 'word' && currentLearnItem.term) {
              speak(currentLearnItem.term);
            } else if (currentLearnItem.type === 'grammar' && currentLearnItem.example) {
              speak(currentLearnItem.example);
            }
          }
        }
      } else {
        // Practice tab shortcuts
        if (e.key === 'n' || e.key === 'N') {
          loadNextPractice();
        } else if (e.key === ' ') {
          e.preventDefault();
          toggleHint();
        } else if (e.key === 'Enter') {
          markKnown();
        } else if (e.key === 'Backspace') {
          e.preventDefault();
          markAgain();
        } else if (e.key === 's' || e.key === 'S') {
          if (currentItem) {
            if (currentItem.type === 'word' && currentItem.term) {
              speak(currentItem.term);
            } else if (currentItem.type === 'grammar' && currentItem.example) {
              speak(currentItem.example);
            }
          }
        }
      }
    });

    // Start app
    init();
  </script>
</body>
</html>
